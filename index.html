<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AR Гра: Перший День у Школі - Весело!</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@master/aframe/build/aframe-ar.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      touch-action: none; /* блокує pinch zoom */
      font-family: Arial, sans-serif;
    }
    a-scene {
      width: 100%;
      height: 100%;
      position: fixed;
      top: 0;
      left: 0;
    }
    #scanText {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #FFD700;
      font-size: 2em;
      font-weight: bold;
      text-shadow: 2px 2px 6px #000;
      z-index: 10;
      text-align: center;
      width: 90%;
    }
    #smartLessaBtn {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #ff0044;
      color: white;
      padding: 14px 24px;
      border-radius: 30px;
      font-size: 1.1em;
      font-weight: bold;
      text-decoration: none;
      z-index: 10;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    #smartLessaBtn:hover {
      background: #cc0036;
    }
  </style>
</head>
<body>
  <div id="scanText">Наведи камеру на зображення Hiro маркера</div>

  <a-scene embedded id="arScene" arjs="sourceType: webcam; detectionMode: mono; trackingMethod: best; facingBack: true;">
    <a-marker id="marker" preset="hiro">
      <!-- Контейнер для гри -->
      <a-entity id="game-container" position="0 0 0" rotation="-90 0 0" scale="0.05 0.05 0.05">
        <a-text id="event-text" value="" position="-1 2 0" width="40" align="center" color="white"></a-text>
        <a-entity id="choiceA" class="choice" position="-1 1 0">
          <a-plane width="2" height="0.5" material="color: green; opacity: 0.7"></a-plane>
          <a-text value="" width="35" align="left" color="white" position="-0.9 -0.2 0.01"></a-text>
        </a-entity>
        <a-entity id="choiceB" class="choice" position="-1 0.5 0">
          <a-plane width="2" height="0.5" material="color: green; opacity: 0.7"></a-plane>
          <a-text value="" width="35" align="left" color="white" position="-0.9 -0.2 0.01"></a-text>
        </a-entity>
        <a-entity id="choiceC" class="choice" position="-1 0 0">
          <a-plane width="2" height="0.5" material="color: green; opacity: 0.7"></a-plane>
          <a-text value="" width="35" align="left" color="white" position="-0.9 -0.2 0.01"></a-text>
        </a-entity>
        <a-entity id="result-container" visible="false">
          <a-text id="result-text" value="" position="-1 1 0" width="40" align="center" color="yellow"></a-text>
          <a-entity id="restart-btn" class="clickable" position="-1 0 0">
            <a-plane width="1.5" height="0.5" material="color: blue; opacity: 0.7"></a-plane>
            <a-text value="Розпочати знову" width="20" align="center" color="white" position="-0.7 -0.2 0.01"></a-text>
          </a-entity>
        </a-entity>
      </a-entity>
    </a-marker>
    <a-entity camera>
      <a-cursor></a-cursor>
    </a-entity>
  </a-scene>

  <a href="https://youtube.com/playlist?list=PL6UDFwT9TzFxsVdFiEBsQ9yFpcYRPOpfO&si=IyXv1SkdPyvhcW7Z"
     id="smartLessaBtn" target="_blank">@SmartLessa</a>

  <script>
    const marker = document.getElementById('marker');
    const scanText = document.getElementById('scanText');
    const gameContainer = document.getElementById('game-container');
    const eventText = document.getElementById('event-text');
    const choiceA = document.getElementById('choiceA');
    const choiceB = document.getElementById('choiceB');
    const choiceC = document.getElementById('choiceC');
    const resultContainer = document.getElementById('result-container');
    const resultText = document.getElementById('result-text');
    const restartBtn = document.getElementById('restart-btn');

    // Події шкільного дня (етапи гри)
    const schoolEvents = [
      {
        event: "Ти приходиш до школи. Що робиш першим?",
        choices: [
          { text: "A) Вітаєшся з друзями", fun: 2, friends: 1 },
          { text: "B) Йдеш до класу одразу", fun: 1, friends: 0 },
          { text: "C) Досліджуєш шкільний двір", fun: 3, friends: 0.5 }
        ]
      },
      {
        event: "На уроці математики вчителька задає питання. Твоя дія?",
        choices: [
          { text: "A) Піднімаєш руку і відповідаєш", fun: 1, knowledge: 2 },
          { text: "B) Шепочеш відповідь другові", fun: 2, knowledge: 1, friends: 1 },
          { text: "C) Малюєш смішні картинки в зошиті", fun: 3, knowledge: 0 }
        ]
      },
      {
        event: "На перерві друзі пропонують пограти. Що обираєш?",
        choices: [
          { text: "A) Футбол на подвір'ї", fun: 3, energy: -1, friends: 2 },
          { text: "B) Розмовляєш про канікули", fun: 2, energy: 0, friends: 1 },
          { text: "C) Ховаєшся в шкільному саду", fun: 2.5, energy: -0.5, friends: 0.5 }
        ]
      },
      {
        event: "В їдальні обід. Що з'їси?",
        choices: [
          { text: "A) Здоровий салат і суп", fun: 1, energy: 2 },
          { text: "B) Піцу з друзями", fun: 3, energy: 1, friends: 1 },
          { text: "C) Солодощі потайки", fun: 2.5, energy: 0.5 }
        ]
      },
      {
        event: "Після уроків. Як завершиш день?",
        choices: [
          { text: "A) Допомагаєш прибирати клас", fun: 1, knowledge: 1, friends: 1 },
          { text: "B) Граєш у ігри з однокласниками", fun: 3, friends: 2 },
          { text: "C) Біжиш додому розповідати про день", fun: 2, energy: -1 }
        ]
      }
    ];

    // Рандомні події для різноманітності
    const randomEvents = [
      "Раптом вчителька розповідає смішний жарт! +1 веселощі",
      "Ти знаходиш забуту іграшку в шкільному дворі! +1 друзі",
      "На перерві падає дощ, але ви граєте під дахом. +1 енергія",
      "Друг ділиться цукеркою. +0.5 веселощі",
      "Ти допомагаєш новому учню знайти клас. +1 знання"
    ];

    let currentEvent = 0;
    let funLevel = 0;
    let friendsMade = 0;
    let knowledgeGained = 0;
    let energyLeft = 5; // Початкова енергія

    function startGame() {
      currentEvent = 0;
      funLevel = 0;
      friendsMade = 0;
      knowledgeGained = 0;
      energyLeft = 5;
      resultContainer.setAttribute('visible', false);
      showEvent();
    }

    function showEvent() {
      if (currentEvent < schoolEvents.length && energyLeft > 0) {
        const e = schoolEvents[currentEvent];
        eventText.setAttribute('value', e.event);
        choiceA.querySelector('a-text').setAttribute('value', e.choices[0].text);
        choiceB.querySelector('a-text').setAttribute('value', e.choices[1].text);
        choiceC.querySelector('a-text').setAttribute('value', e.choices[2].text);

        // Додаємо рандомну подію для різноманітності
        if (Math.random() > 0.5) { // 50% шанс
          const randomIndex = Math.floor(Math.random() * randomEvents.length);
          const randomEvent = randomEvents[randomIndex];
          eventText.setAttribute('value', e.event + '\n' + randomEvent);
          // Застосовуємо ефект рандомної події
          if (randomEvent.includes('веселощі')) funLevel += parseFloat(randomEvent.match(/\+([\d.]+)/)[1]);
          if (randomEvent.includes('друзі')) friendsMade += parseFloat(randomEvent.match(/\+([\d.]+)/)[1]);
          if (randomEvent.includes('енергія')) energyLeft += parseFloat(randomEvent.match(/\+([\d.]+)/)[1]);
          if (randomEvent.includes('знання')) knowledgeGained += parseFloat(randomEvent.match(/\+([\d.]+)/)[1]);
        }
      } else {
        showResult();
      }
    }

    function handleChoice(choiceIndex) {
      if (currentEvent >= schoolEvents.length) return;
      const e = schoolEvents[currentEvent];
      const selected = e.choices[choiceIndex];
      funLevel += selected.fun || 0;
      friendsMade += selected.friends || 0;
      knowledgeGained += selected.knowledge || 0;
      energyLeft += selected.energy || 0;

      // Рандомне зменшення енергії для реалістичності
      if (Math.random() > 0.7) {
        energyLeft -= 0.5;
        eventText.setAttribute('value', eventText.getAttribute('value') + '\nТрохи втомився... -0.5 енергія');
      }

      currentEvent++;
      showEvent();
    }

    function showResult() {
      eventText.setAttribute('value', '');
      choiceA.querySelector('a-text').setAttribute('value', '');
      choiceB.querySelector('a-text').setAttribute('value', '');
      choiceC.querySelector('a-text').setAttribute('value', '');
      let badge = '';
      if (funLevel > 10) badge = 'Супер-веселий день! 🎉🎉🎉';
      else if (funLevel > 5) badge = 'Веселий день! 🎉🎉';
      else badge = 'Цікавий день! 🎉';
      resultText.setAttribute('value', `Твій день у школі:\nВеселощі: ${funLevel}\nДрузі: ${friendsMade}\nЗнання: ${knowledgeGained}\nЕнергія: ${energyLeft}\n${badge}`);
      resultContainer.setAttribute('visible', true);
    }

    // Додаємо обробники кліків
    choiceA.addEventListener('click', () => handleChoice(0));
    choiceB.addEventListener('click', () => handleChoice(1));
    choiceC.addEventListener('click', () => handleChoice(2));
    restartBtn.addEventListener('click', startGame);

    // Події маркера
    marker.addEventListener('markerFound', () => {
      scanText.style.display = 'none';
      startGame();
    });

    marker.addEventListener('markerLost', () => {
      scanText.style.display = 'block';
    });

    // Перевірка доступу до камери
    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
      .then(stream => {
        console.log('Доступ до задньої камери надано');
      })
      .catch(err => {
        scanText.textContent = 'Дозвольте доступ до задньої камери для AR';
        console.error('Помилка доступу до камери:', err);
      });

    // Фікс висоти для мобільних браузерів
    function fixHeight() {
      document.body.style.height = window.innerHeight + 'px';
    }
    window.addEventListener('resize', fixHeight);
    fixHeight();
  </script>
</body>
</html>